@page "/authors"
@using BlazorWasmAuth.Shared.Domain
@inject IHttpClientFactory ClientFactory

<h3>AuthorsPage</h3>

<AuthorizeView>
    <Authorized>
        <p>Hello, @context.User.Identity?.Name! You're authenticated.</p>
    </Authorized>
    <NotAuthorized>
        <p>Hello! You're <em>NOT</em> authenticated, so processing data will fail.</p>
    </NotAuthorized>
</AuthorizeView>

<FluentCard AreaRestricted="false">
    <FluentDataGrid Items="@_authors">
        <PropertyColumn Property="@(p => p.Id)" />
        <PropertyColumn Property="@(p => p.FirstName)"  />
        <PropertyColumn Property="@(p => p.LastName)"  />
        <PropertyColumn Property="@(p => p.EMail)"  />
    </FluentDataGrid>
</FluentCard>
@code {

    private IQueryable<Author> _authors = Enumerable.Empty<Author>().AsQueryable();
    private string? _error = null;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var client = GetAuthorizedHttpClient();
            var authors = await client.GetFromJsonAsync<List<Author>>("/api/v1/authors");
            _authors = authors.AsQueryable();

        }
        catch (Exception e)
        {
            _error = e.ToString();

        }
        
    }

    private HttpClient GetAuthorizedHttpClient() => ClientFactory.CreateClient("Auth");
}